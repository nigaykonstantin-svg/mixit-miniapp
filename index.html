<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MIXIT Creators</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        pink: {
                            50: '#FFF0F5',
                            100: '#FFE4EC',
                            200: '#FFCCD9',
                            300: '#FFB3C6',
                            400: '#FF8AAB',
                            500: '#FF6B9D',
                            600: '#FF4081',
                            700: '#E91E63',
                        },
                        mixit: '#FF6B9D',
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style>
        * { font-family: 'Inter', sans-serif; }
        
        :root {
            --safe-bottom: env(safe-area-inset-bottom, 0px);
        }
        
        body {
            background: #FAFAFA;
            padding-bottom: calc(80px + var(--safe-bottom));
            -webkit-tap-highlight-color: transparent;
        }
        
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        .glass {
            background: rgba(255,255,255,0.9);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }
        
        .gradient-pink {
            background: linear-gradient(135deg, #FF6B9D 0%, #FF8AAB 50%, #FFB3C6 100%);
        }
        
        .gradient-gold {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
        }
        
        .card {
            background: white;
            border-radius: 20px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.06);
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:active {
            transform: scale(0.98);
        }
        
        .badge {
            font-size: 10px;
            font-weight: 700;
            padding: 4px 8px;
            border-radius: 6px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .badge-hit { background: linear-gradient(135deg, #FF6B9D, #FF4081); color: white; }
        .badge-new { background: linear-gradient(135deg, #4CAF50, #66BB6A); color: white; }
        .badge-limited { background: linear-gradient(135deg, #9C27B0, #BA68C8); color: white; }
        
        .level-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .level-0 { background: linear-gradient(135deg, #CD7F32, #B8860B); color: white; }
        .level-1 { background: linear-gradient(135deg, #C0C0C0, #A8A8A8); color: white; }
        .level-2 { background: linear-gradient(135deg, #FFD700, #FFA500); color: #333; }
        .level-3 { background: linear-gradient(135deg, #E5E4E2, #C0C0C0); color: #333; }
        .level-4 { background: linear-gradient(135deg, #B9F2FF, #89CFF0); color: #333; }
        
        .progress-bar {
            height: 8px;
            border-radius: 4px;
            background: #f0f0f0;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            border-radius: 4px;
            background: linear-gradient(90deg, #FF6B9D, #FF8AAB);
            transition: width 0.5s ease;
        }
        
        .tab-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-top: 1px solid #f0f0f0;
            padding: 8px 0;
            padding-bottom: calc(8px + var(--safe-bottom));
            z-index: 100;
        }
        
        .tab-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 8px;
            color: #999;
            transition: all 0.2s;
        }
        
        .tab-item.active {
            color: #FF6B9D;
        }
        
        .tab-item .icon {
            font-size: 24px;
        }
        
        .tab-item .label {
            font-size: 10px;
            font-weight: 500;
        }
        
        .floating-cart {
            position: fixed;
            bottom: calc(90px + var(--safe-bottom));
            left: 16px;
            right: 16px;
            z-index: 90;
        }
        
        .timer-box {
            background: #1a1a1a;
            color: white;
            padding: 8px 12px;
            border-radius: 10px;
            text-align: center;
            min-width: 50px;
        }
        
        .achievement-locked {
            filter: grayscale(100%);
            opacity: 0.4;
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .slide-up {
            animation: slideUp 0.4s ease-out;
        }
        
        @keyframes slideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .shake {
            animation: shake 0.5s ease-in-out;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-8px); }
            75% { transform: translateX(8px); }
        }
        
        .bounce-in {
            animation: bounceIn 0.5s ease-out;
        }
        
        @keyframes bounceIn {
            0% { transform: scale(0.5); opacity: 0; }
            70% { transform: scale(1.1); }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .product-selected {
            box-shadow: 0 0 0 3px #FF6B9D, 0 4px 20px rgba(255,107,157,0.3);
        }
        
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.5);
            z-index: 200;
            display: flex;
            align-items: flex-end;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            border-radius: 24px 24px 0 0;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            padding-bottom: var(--safe-bottom);
        }
        
        .status-pending { color: #FF9800; }
        .status-shipped { color: #2196F3; }
        .status-delivered { color: #9C27B0; }
        .status-awaiting { color: #FF6B9D; }
        .status-completed { color: #4CAF50; }
    </style>
</head>
<body>
    <div id="app"></div>

    <script>
        // ==================== TELEGRAM ====================
        const tg = window.Telegram?.WebApp;
        if (tg) {
            tg.ready();
            tg.expand();
            tg.enableClosingConfirmation();
        }
        
        const tgUser = tg?.initDataUnsafe?.user || {
            id: 123456789,
            first_name: '–ê–Ω–Ω–∞',
            last_name: '–ö–æ—Å–º–µ—Ç–∏–∫—Å',
            username: 'anna_beauty'
        };

        // ==================== DATA ====================
        
        const PRODUCTS = [
            { id: 1, name: 'Skin Chemistry Serum', category: '–õ–∏—Ü–æ', volume: '30 ml', desc: '–°—ã–≤–æ—Ä–æ—Ç–∫–∞ —Å –≥–∏–∞–ª—É—Ä–æ–Ω–æ–≤–æ–π –∫–∏—Å–ª–æ—Ç–æ–π –¥–ª—è –≥–ª—É–±–æ–∫–æ–≥–æ —É–≤–ª–∞–∂–Ω–µ–Ω–∏—è –∏ —Å–∏—è–Ω–∏—è –∫–æ–∂–∏', rating: 4.9, reviews: 128, badge: 'HIT', image: 'üß¥', color: '#FFB5C5', minLevel: 0 },
            { id: 2, name: 'Coco Sulfate Free', category: '–í–æ–ª–æ—Å—ã', volume: '250 ml', desc: '–ë–µ—Å—Å—É–ª—å—Ñ–∞—Ç–Ω—ã–π —à–∞–º–ø—É–Ω—å —Å –∫–æ–∫–æ—Å–æ–≤—ã–º –º–∞—Å–ª–æ–º –¥–ª—è –º—è–≥–∫–æ–≥–æ –æ—á–∏—â–µ–Ω–∏—è', rating: 4.8, reviews: 95, badge: 'NEW', image: 'ü••', color: '#87CEEB', minLevel: 0 },
            { id: 3, name: 'Coffee Body Scrub', category: '–¢–µ–ª–æ', volume: '200 g', desc: '–ö–æ—Ñ–µ–π–Ω—ã–π —Å–∫—Ä–∞–± –¥–ª—è —Ç–µ–ª–∞ —Å –∞–Ω—Ç–∏—Ü–µ–ª–ª—é–ª–∏—Ç–Ω—ã–º —ç—Ñ—Ñ–µ–∫—Ç–æ–º', rating: 5.0, reviews: 203, badge: null, image: '‚òï', color: '#DEB887', minLevel: 0 },
            { id: 4, name: 'Matte Lipstick Rose', category: '–ú–∞–∫–∏—è–∂', volume: '4 g', desc: '–ú–∞—Ç–æ–≤–∞—è –ø–æ–º–∞–¥–∞ –Ω–∞—Ç—É—Ä–∞–ª—å–Ω–æ–≥–æ —Ä–æ–∑–æ–≤–æ–≥–æ –æ—Ç—Ç–µ–Ω–∫–∞', rating: 4.7, reviews: 156, badge: 'HIT', image: 'üíÑ', color: '#FF6B9D', minLevel: 0 },
            { id: 5, name: 'Hydra Face Cream', category: '–õ–∏—Ü–æ', volume: '50 ml', desc: '–£–≤–ª–∞–∂–Ω—è—é—â–∏–π –∫—Ä–µ–º –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –∫–æ–∂–∏ —Å SPF 15', rating: 4.6, reviews: 87, badge: null, image: '‚ú®', color: '#E6E6FA', minLevel: 0 },
            { id: 6, name: 'Keratin Hair Mask', category: '–í–æ–ª–æ—Å—ã', volume: '300 ml', desc: '–í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—â–∞—è –º–∞—Å–∫–∞ —Å –∫–µ—Ä–∞—Ç–∏–Ω–æ–º –¥–ª—è –ø–æ–≤—Ä–µ–∂–¥—ë–Ω–Ω—ã—Ö –≤–æ–ª–æ—Å', rating: 4.9, reviews: 142, badge: 'NEW', image: 'üíÜ', color: '#98FB98', minLevel: 1 },
            { id: 7, name: 'Shea Body Butter', category: '–¢–µ–ª–æ', volume: '150 ml', desc: '–ü–∏—Ç–∞—Ç–µ–ª—å–Ω–æ–µ –º–∞—Å–ª–æ —à–∏ –¥–ª—è –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ–≥–æ —É–≤–ª–∞–∂–Ω–µ–Ω–∏—è —Ç–µ–ª–∞', rating: 4.8, reviews: 118, badge: null, image: 'üßà', color: '#FFEFD5', minLevel: 0 },
            { id: 8, name: 'Eyeshadow Palette', category: '–ú–∞–∫–∏—è–∂', volume: '12 colors', desc: '–ü–∞–ª–µ—Ç–∫–∞ —Ç–µ–Ω–µ–π –Ω–∞—Ç—É—Ä–∞–ª—å–Ω—ã—Ö –æ—Ç—Ç–µ–Ω–∫–æ–≤ –¥–ª—è –¥–Ω–µ–≤–Ω–æ–≥–æ –∏ –≤–µ—á–µ—Ä–Ω–µ–≥–æ –º–∞–∫–∏—è–∂–∞', rating: 4.9, reviews: 231, badge: 'HIT', image: 'üé®', color: '#D2691E', minLevel: 1 },
            { id: 9, name: 'Vitamin C Booster', category: '–õ–∏—Ü–æ', volume: '15 ml', desc: '–°—ã–≤–æ—Ä–æ—Ç–∫–∞-–±—É—Å—Ç–µ—Ä —Å –≤–∏—Ç–∞–º–∏–Ω–æ–º –° –¥–ª—è —Å–∏—è–Ω–∏—è –∏ —Ä–æ–≤–Ω–æ–≥–æ —Ç–æ–Ω–∞', rating: 4.7, reviews: 76, badge: null, image: 'üçä', color: '#FFA500', minLevel: 1 },
            { id: 10, name: 'Argan Oil Elixir', category: '–í–æ–ª–æ—Å—ã', volume: '100 ml', desc: '–ú–∞—Å–ª–æ –∞—Ä–≥–∞–Ω—ã –¥–ª—è –±–ª–µ—Å–∫–∞ –∏ –∑–∞—â–∏—Ç—ã –≤–æ–ª–æ—Å –æ—Ç –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–π', rating: 5.0, reviews: 189, badge: 'LIMITED', image: 'üíé', color: '#FFD700', minLevel: 2 },
            { id: 11, name: 'AHA/BHA Peeling', category: '–õ–∏—Ü–æ', volume: '30 ml', desc: '–ú—è–≥–∫–∏–π –ø–∏–ª–∏–Ω–≥ —Å –∫–∏—Å–ª–æ—Ç–∞–º–∏ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–∂–∏', rating: 4.8, reviews: 92, badge: 'NEW', image: 'üß™', color: '#E0FFFF', minLevel: 1 },
            { id: 12, name: 'Mascara Volume', category: '–ú–∞–∫–∏—è–∂', volume: '10 ml', desc: '–¢—É—à—å –¥–ª—è –æ–±—ä—ë–º–∞ –∏ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è —Ä–µ—Å–Ω–∏—Ü', rating: 4.6, reviews: 167, badge: null, image: 'üëÅÔ∏è', color: '#2F4F4F', minLevel: 0 },
        ];
        
        const LEVELS = [
            { name: '–ù–∞—á–∏–Ω–∞—é—â–∏–π', minFollowers: 1000, maxFollowers: 10000, minER: 3, products: [2, 4], days: 14, collabs: 1, emoji: 'ü•â', color: '#CD7F32', pointsToNext: 1000 },
            { name: '–ü–æ–¥–∞—é—â–∏–π –Ω–∞–¥–µ–∂–¥—ã', minFollowers: 10000, maxFollowers: 50000, minER: 4, products: [3, 5], days: 21, collabs: 2, emoji: 'ü•à', color: '#C0C0C0', pointsToNext: 3000 },
            { name: '–û–ø—ã—Ç–Ω—ã–π', minFollowers: 50000, maxFollowers: 150000, minER: 3.5, products: [4, 6], days: 30, collabs: 3, emoji: 'ü•á', color: '#FFD700', pointsToNext: 7000 },
            { name: '–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π', minFollowers: 150000, maxFollowers: 500000, minER: 3, products: [6, 8], days: 45, collabs: 999, emoji: 'üíé', color: '#E5E4E2', pointsToNext: 15000 },
            { name: '–ó–≤–µ–∑–¥–∞', minFollowers: 500000, maxFollowers: Infinity, minER: 2.5, products: [8, 12], days: 60, collabs: 999, emoji: '‚≠ê', color: '#B9F2FF', pointsToNext: null },
        ];
        
        const ACHIEVEMENTS = [
            { id: 1, name: '–ü–µ—Ä–≤—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç', desc: '–ó–∞–≤–µ—Ä—à–∏—Ç–µ –ø–µ—Ä–≤—É—é –∫–æ–ª–ª–∞–±–æ—Ä–∞—Ü–∏—é', icon: 'üé¨', condition: 'collabs >= 1', points: 100 },
            { id: 2, name: '–ü—É–Ω–∫—Ç—É–∞–ª—å–Ω—ã–π', desc: '5 –∫–æ–ª–ª–∞–±–æ—Ä–∞—Ü–∏–π –≤–æ–≤—Ä–µ–º—è –ø–æ–¥—Ä—è–¥', icon: '‚è∞', condition: 'onTimeStreak >= 5', points: 250 },
            { id: 3, name: '–í–∏—Ä–∞–ª—å–Ω—ã–π', desc: '–ö–æ–Ω—Ç–µ–Ω—Ç —Å ER –≤—ã—à–µ 2x –æ—Ç —Å—Ä–µ–¥–Ω–µ–≥–æ', icon: 'üöÄ', condition: 'viralContent >= 1', points: 300 },
            { id: 4, name: '–õ–æ—è–ª—å–Ω—ã–π', desc: '10 —É—Å–ø–µ—à–Ω—ã—Ö –∫–æ–ª–ª–∞–±–æ—Ä–∞—Ü–∏–π', icon: 'üíé', condition: 'collabs >= 10', points: 500 },
            { id: 5, name: '–°–ø—Ä–∏–Ω—Ç–µ—Ä', desc: '–°–¥–∞–π—Ç–µ –∫–æ–Ω—Ç–µ–Ω—Ç –∑–∞ 3 –¥–Ω—è', icon: '‚ö°', condition: 'fastDelivery >= 1', points: 200 },
            { id: 6, name: '–≠–∫—Å–ø–µ—Ä—Ç –ª–∏—Ü–∞', desc: '5 –∫–æ–ª–ª–∞–±–æ—Ä–∞—Ü–∏–π —Å –ø—Ä–æ–¥—É–∫—Ç–∞–º–∏ –¥–ª—è –ª–∏—Ü–∞', icon: '‚ú®', condition: 'faceCollabs >= 5', points: 300 },
            { id: 7, name: '–≠–∫—Å–ø–µ—Ä—Ç –≤–æ–ª–æ—Å', desc: '5 –∫–æ–ª–ª–∞–±–æ—Ä–∞—Ü–∏–π —Å –ø—Ä–æ–¥—É–∫—Ç–∞–º–∏ –¥–ª—è –≤–æ–ª–æ—Å', icon: 'üíá', condition: 'hairCollabs >= 5', points: 300 },
            { id: 8, name: '–¢–æ–ø –Ω–µ–¥–µ–ª–∏', desc: '–ü–æ–ø–∞–¥–∏—Ç–µ –≤ —Ç–æ–ø-10 —Å–≤–æ–µ–≥–æ —É—Ä–æ–≤–Ω—è', icon: 'üèÜ', condition: 'weeklyTop10 >= 1', points: 400 },
            { id: 9, name: '–ê–º–±–∞—Å—Å–∞–¥–æ—Ä', desc: '–ü—Ä–∏–≥–ª–∞—Å–∏—Ç–µ 3 –¥—Ä—É–∑–µ–π', icon: 'ü§ù', condition: 'referrals >= 3', points: 350 },
        ];
        
        const LEADERBOARD = [
            { rank: 1, name: '–ê–ª–∏–Ω–∞ –ö–æ—Å–º–µ—Ç–∏–∫—Å', username: '@alina_cosmetics', points: 2450, avatar: 'üë©‚Äçü¶∞', isCurrentUser: false },
            { rank: 2, name: 'Beauty Maria', username: '@beauty_maria', points: 2180, avatar: 'üë©‚Äçü¶±', isCurrentUser: false },
            { rank: 3, name: '–ö–∞—Ç—è –ë—å—é—Ç–∏', username: '@katya_beauty', points: 1950, avatar: 'üë©', isCurrentUser: false },
            { rank: 4, name: 'Skin Care Pro', username: '@skincare_pro', points: 1820, avatar: 'üë±‚Äç‚ôÄÔ∏è', isCurrentUser: false },
            { rank: 5, name: 'Makeup Queen', username: '@makeup_queen', points: 1650, avatar: 'üë∏', isCurrentUser: false },
            { rank: 6, name: '–ê–Ω–Ω–∞ –ö–æ—Å–º–µ—Ç–∏–∫—Å', username: '@anna_beauty', points: 1450, avatar: 'üíÅ‚Äç‚ôÄÔ∏è', isCurrentUser: true },
            { rank: 7, name: 'Glow Girl', username: '@glow_girl', points: 1380, avatar: 'üßö', isCurrentUser: false },
            { rank: 8, name: 'Beauty Lab', username: '@beauty_lab', points: 1290, avatar: 'üë©‚Äçüî¨', isCurrentUser: false },
            { rank: 9, name: '–ö–æ—Å–º–µ—Ç–æ–ª–æ–≥ –õ–µ–Ω–∞', username: '@lena_cosmo', points: 1150, avatar: 'üë©‚Äç‚öïÔ∏è', isCurrentUser: false },
            { rank: 10, name: 'Pretty Face', username: '@pretty_face', points: 1020, avatar: 'üå∏', isCurrentUser: false },
        ];

        // ==================== STATE ====================
        
        let state = {
            // Navigation
            currentTab: 'home',
            currentPage: 'main', // main, catalog, product, cart, delivery, collab-detail
            
            // User
            user: {
                id: tgUser.id,
                name: tgUser.first_name + ' ' + (tgUser.last_name || ''),
                username: '@' + (tgUser.username || 'user'),
                instagram: '@anna_beauty',
                tiktok: null,
                status: 'approved', // new, pending, approved
                levelIndex: 1,
                points: 1450,
                followers: 15200,
                er: 4.8,
                totalCollabs: 7,
                successfulCollabs: 6,
                onTimeStreak: 4,
                achievements: [1, 5],
                referralCode: 'ANNA2024',
                referrals: 1,
            },
            
            // Catalog
            selectedCategory: '–í—Å–µ',
            selectedProducts: [],
            currentProduct: null,
            
            // Cart & Delivery
            delivery: { name: '', phone: '', address: '', comment: '' },
            
            // Collaborations
            collaborations: [
                {
                    id: 1,
                    status: 'awaiting',
                    products: [1, 2],
                    createdAt: '2024-12-05',
                    deadline: '2024-12-25',
                    deliveredAt: '2024-12-10',
                    contentLink: null,
                    rating: null,
                },
                {
                    id: 2,
                    status: 'completed',
                    products: [3],
                    createdAt: '2024-11-01',
                    deadline: '2024-11-20',
                    deliveredAt: '2024-11-05',
                    contentLink: 'https://instagram.com/p/xxx',
                    submittedAt: '2024-11-18',
                    rating: 5,
                    pointsEarned: 350,
                },
                {
                    id: 3,
                    status: 'completed',
                    products: [4, 5],
                    createdAt: '2024-10-10',
                    deadline: '2024-10-30',
                    deliveredAt: '2024-10-15',
                    contentLink: 'https://instagram.com/p/yyy',
                    submittedAt: '2024-10-25',
                    rating: 4,
                    pointsEarned: 280,
                },
            ],
            
            // UI
            showModal: null,
            modalData: null,
        };
        
        // Load saved state
        const saved = localStorage.getItem('mixit_v2_state');
        if (saved) {
            try {
                const parsed = JSON.parse(saved);
                state = { ...state, ...parsed };
            } catch (e) {}
        }
        
        function saveState() {
            localStorage.setItem('mixit_v2_state', JSON.stringify(state));
        }

        // ==================== HELPERS ====================
        
        function formatNumber(num) {
            if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
            if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
            return num.toString();
        }
        
        function getLevel() {
            return LEVELS[state.user.levelIndex];
        }
        
        function getNextLevel() {
            return LEVELS[state.user.levelIndex + 1] || null;
        }
        
        function getLevelProgress() {
            const level = getLevel();
            if (!level.pointsToNext) return 100;
            const prevPoints = state.user.levelIndex > 0 ? LEVELS[state.user.levelIndex - 1].pointsToNext : 0;
            const needed = level.pointsToNext - prevPoints;
            const current = state.user.points - prevPoints;
            return Math.min(100, Math.max(0, (current / needed) * 100));
        }
        
        function getTimeRemaining(deadline) {
            const now = new Date();
            const end = new Date(deadline);
            const diff = end - now;
            
            if (diff <= 0) return { days: 0, hours: 0, mins: 0, expired: true };
            
            return {
                days: Math.floor(diff / (1000 * 60 * 60 * 24)),
                hours: Math.floor((diff / (1000 * 60 * 60)) % 24),
                mins: Math.floor((diff / (1000 * 60)) % 60),
                expired: false,
            };
        }
        
        function getStatusText(status) {
            const map = {
                pending: '–û–∂–∏–¥–∞–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏',
                shipped: '–í –ø—É—Ç–∏',
                delivered: '–î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ',
                awaiting: '–û–∂–∏–¥–∞–µ—Ç –∫–æ–Ω—Ç–µ–Ω—Ç',
                completed: '–ó–∞–≤–µ—Ä—à–µ–Ω–æ',
            };
            return map[status] || status;
        }
        
        function getStatusColor(status) {
            const map = {
                pending: 'text-amber-500',
                shipped: 'text-blue-500',
                delivered: 'text-purple-500',
                awaiting: 'text-pink-500',
                completed: 'text-green-500',
            };
            return map[status] || 'text-gray-500';
        }
        
        function isAchievementUnlocked(achievement) {
            return state.user.achievements.includes(achievement.id);
        }
        
        function haptic(type = 'light') {
            tg?.HapticFeedback?.impactOccurred(type);
        }

        // ==================== RENDER ====================
        
        function render() {
            const app = document.getElementById('app');
            
            if (state.user.status === 'new') {
                app.innerHTML = renderRegistration();
            } else if (state.user.status === 'pending') {
                app.innerHTML = renderPending();
            } else {
                app.innerHTML = renderApp();
            }
            
            saveState();
        }
        
        // ==================== REGISTRATION ====================
        
        function renderRegistration() {
            return `
                <div class="min-h-screen p-4">
                    <div class="text-center pt-8 pb-6">
                        <div class="w-20 h-20 gradient-pink rounded-2xl flex items-center justify-center text-4xl mx-auto mb-4 shadow-lg bounce-in">
                            ‚ú®
                        </div>
                        <h1 class="text-2xl font-bold mb-2">MIXIT Creators</h1>
                        <p class="text-gray-500">–°—Ç–∞–Ω—å—Ç–µ —á–∞—Å—Ç—å—é –∫–æ–º–∞–Ω–¥—ã</p>
                    </div>
                    
                    <div class="card p-5 mb-4 slide-up">
                        <div class="flex items-center gap-3 p-3 bg-green-50 rounded-xl mb-5">
                            <span class="text-2xl">‚úÖ</span>
                            <div class="flex-1">
                                <p class="font-medium text-green-800">${state.user.name}</p>
                                <p class="text-sm text-green-600">Telegram –ø–æ–¥–∫–ª—é—á—ë–Ω</p>
                            </div>
                        </div>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="text-sm text-gray-500 mb-1.5 block">Instagram *</label>
                                <input type="text" id="instagram" placeholder="@–≤–∞—à_–∞–∫–∫–∞—É–Ω—Ç"
                                    class="w-full px-4 py-3.5 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-pink-500 focus:border-transparent">
                            </div>
                            
                            <div>
                                <label class="text-sm text-gray-500 mb-1.5 block">TikTok (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                                <input type="text" id="tiktok" placeholder="@–≤–∞—à_–∞–∫–∫–∞—É–Ω—Ç"
                                    class="w-full px-4 py-3.5 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-pink-500 focus:border-transparent">
                            </div>
                            
                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="text-sm text-gray-500 mb-1.5 block">–ü–æ–¥–ø–∏—Å—á–∏–∫–∏</label>
                                    <input type="number" id="followers" placeholder="15000"
                                        class="w-full px-4 py-3.5 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-pink-500 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="text-sm text-gray-500 mb-1.5 block">ER %</label>
                                    <input type="number" id="er" placeholder="4.5" step="0.1"
                                        class="w-full px-4 py-3.5 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-pink-500 focus:border-transparent">
                                </div>
                            </div>
                            
                            <div>
                                <label class="text-sm text-gray-500 mb-1.5 block">–ù–∏—à–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞</label>
                                <select id="niche" class="w-full px-4 py-3.5 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-pink-500 bg-white">
                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∏—à—É</option>
                                    <option value="beauty">Beauty</option>
                                    <option value="skincare">Skincare</option>
                                    <option value="lifestyle">Lifestyle</option>
                                    <option value="fashion">Fashion</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card p-5 mb-6 slide-up" style="animation-delay: 0.1s">
                        <h3 class="font-semibold mb-3">–ß—Ç–æ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ</h3>
                        <div class="space-y-3">
                            <div class="flex items-start gap-3">
                                <span class="text-xl">üéÅ</span>
                                <div>
                                    <p class="font-medium text-sm">–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã</p>
                                    <p class="text-xs text-gray-500">–í—ã–±–∏—Ä–∞–π—Ç–µ –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞ –¥–ª—è –æ–±–∑–æ—Ä–æ–≤</p>
                                </div>
                            </div>
                            <div class="flex items-start gap-3">
                                <span class="text-xl">üèÜ</span>
                                <div>
                                    <p class="font-medium text-sm">–°–∏—Å—Ç–µ–º–∞ —É—Ä–æ–≤–Ω–µ–π</p>
                                    <p class="text-xs text-gray-500">–†–∞—Å—Ç–∏—Ç–µ –∏ –ø–æ–ª—É—á–∞–π—Ç–µ –±–æ–ª—å—à–µ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π</p>
                                </div>
                            </div>
                            <div class="flex items-start gap-3">
                                <span class="text-xl">üí∞</span>
                                <div>
                                    <p class="font-medium text-sm">–î–µ–Ω–µ–∂–Ω–æ–µ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏–µ</p>
                                    <p class="text-xs text-gray-500">–î–ª—è —Ç–æ–ø–æ–≤—ã—Ö –±–ª–æ–≥–µ—Ä–æ–≤</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <button onclick="submitRegistration()" class="w-full gradient-pink text-white py-4 rounded-xl font-semibold text-lg shadow-lg active:scale-[0.98] transition-transform">
                        –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É
                    </button>
                </div>
            `;
        }
        
        function submitRegistration() {
            const instagram = document.getElementById('instagram').value;
            const followers = parseInt(document.getElementById('followers').value) || 0;
            const er = parseFloat(document.getElementById('er').value) || 0;
            const niche = document.getElementById('niche').value;
            
            if (!instagram || !followers || !er || !niche) {
                tg?.showAlert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è');
                return;
            }
            
            let levelIndex = 0;
            for (let i = LEVELS.length - 1; i >= 0; i--) {
                if (followers >= LEVELS[i].minFollowers && er >= LEVELS[i].minER) {
                    levelIndex = i;
                    break;
                }
            }
            
            state.user = {
                ...state.user,
                instagram,
                tiktok: document.getElementById('tiktok').value || null,
                followers,
                er,
                niche,
                levelIndex,
                status: 'pending',
            };
            
            if (tg) {
                tg.sendData(JSON.stringify({ action: 'register', user: state.user }));
            }
            
            haptic('success');
            render();
        }
        
        // ==================== PENDING ====================
        
        function renderPending() {
            const level = LEVELS[state.user.levelIndex];
            return `
                <div class="min-h-screen flex flex-col items-center justify-center p-6 text-center">
                    <div class="w-24 h-24 bg-amber-100 rounded-full flex items-center justify-center text-5xl mb-6 pulse">
                        ‚è≥
                    </div>
                    <h1 class="text-2xl font-bold mb-2">–ó–∞—è–≤–∫–∞ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏</h1>
                    <p class="text-gray-500 mb-8">–û–±—ã—á–Ω–æ —ç—Ç–æ –∑–∞–Ω–∏–º–∞–µ—Ç –¥–æ 24 —á–∞—Å–æ–≤</p>
                    
                    <div class="card p-5 w-full max-w-sm">
                        <div class="flex items-center justify-between py-3 border-b border-gray-100">
                            <span class="text-gray-500">Instagram</span>
                            <span class="font-medium">${state.user.instagram}</span>
                        </div>
                        <div class="flex items-center justify-between py-3 border-b border-gray-100">
                            <span class="text-gray-500">–ü–æ–¥–ø–∏—Å—á–∏–∫–∏</span>
                            <span class="font-semibold">${formatNumber(state.user.followers)}</span>
                        </div>
                        <div class="flex items-center justify-between py-3 border-b border-gray-100">
                            <span class="text-gray-500">ER</span>
                            <span class="font-semibold text-green-500">${state.user.er}%</span>
                        </div>
                        <div class="flex items-center justify-between py-3">
                            <span class="text-gray-500">–£—Ä–æ–≤–µ–Ω—å</span>
                            <span class="level-badge level-${state.user.levelIndex}">${level.emoji} ${level.name}</span>
                        </div>
                    </div>
                    
                    <button onclick="simulateApproval()" class="mt-8 text-pink-500 text-sm underline">
                        (–î–µ–º–æ: –æ–¥–æ–±—Ä–∏—Ç—å –∑–∞—è–≤–∫—É)
                    </button>
                </div>
            `;
        }
        
        function simulateApproval() {
            state.user.status = 'approved';
            haptic('success');
            tg?.showAlert('–ó–∞—è–≤–∫–∞ –æ–¥–æ–±—Ä–µ–Ω–∞! üéâ');
            render();
        }

        // ==================== MAIN APP ====================
        
        function renderApp() {
            let content = '';
            
            switch (state.currentTab) {
                case 'home':
                    content = renderHome();
                    break;
                case 'catalog':
                    content = state.currentPage === 'product' ? renderProductDetail() : renderCatalog();
                    break;
                case 'collabs':
                    content = state.currentPage === 'collab-detail' ? renderCollabDetail() : renderCollabs();
                    break;
                case 'rating':
                    content = renderRating();
                    break;
                case 'profile':
                    content = renderProfile();
                    break;
            }
            
            return `
                ${content}
                ${renderTabBar()}
                ${state.selectedProducts.length > 0 && state.currentTab === 'catalog' && state.currentPage !== 'product' ? renderFloatingCart() : ''}
                ${state.showModal ? renderModal() : ''}
            `;
        }
        
        // ==================== HOME ====================
        
        function renderHome() {
            const level = getLevel();
            const nextLevel = getNextLevel();
            const progress = getLevelProgress();
            const activeCollab = state.collaborations.find(c => c.status === 'awaiting');
            
            return `
                <div class="pb-4">
                    <!-- Header -->
                    <div class="gradient-pink p-5 pb-16 rounded-b-[32px]">
                        <div class="flex items-center justify-between mb-6">
                            <div>
                                <p class="text-white/70 text-sm">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å</p>
                                <h1 class="text-white text-xl font-bold">${state.user.name}</h1>
                            </div>
                            <div class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center text-2xl">
                                üíÅ‚Äç‚ôÄÔ∏è
                            </div>
                        </div>
                        
                        <div class="flex items-center gap-4">
                            <div class="flex-1">
                                <div class="flex items-center gap-2 mb-2">
                                    <span class="text-2xl">${level.emoji}</span>
                                    <span class="text-white font-semibold">${level.name}</span>
                                </div>
                                ${nextLevel ? `
                                    <div class="bg-white/20 rounded-full h-2 mb-1">
                                        <div class="bg-white rounded-full h-2 transition-all" style="width: ${progress}%"></div>
                                    </div>
                                    <p class="text-white/70 text-xs">–î–æ ${nextLevel.name}: ${level.pointsToNext - state.user.points} –æ—á–∫–æ–≤</p>
                                ` : `
                                    <p class="text-white/70 text-xs">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å!</p>
                                `}
                            </div>
                            <div class="text-right">
                                <p class="text-white text-3xl font-bold">${state.user.points}</p>
                                <p class="text-white/70 text-xs">–æ—á–∫–æ–≤</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Stats Cards -->
                    <div class="px-4 -mt-10">
                        <div class="card p-4 mb-4">
                            <div class="grid grid-cols-3 gap-4">
                                <div class="text-center">
                                    <p class="text-2xl font-bold">${formatNumber(state.user.followers)}</p>
                                    <p class="text-xs text-gray-500">–ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤</p>
                                </div>
                                <div class="text-center border-x border-gray-100">
                                    <p class="text-2xl font-bold text-green-500">${state.user.er}%</p>
                                    <p class="text-xs text-gray-500">ER</p>
                                </div>
                                <div class="text-center">
                                    <p class="text-2xl font-bold">${state.user.totalCollabs}</p>
                                    <p class="text-xs text-gray-500">–∫–æ–ª–ª–∞–±–æ–≤</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Active Collab -->
                        ${activeCollab ? `
                            <div class="card p-4 mb-4 border-2 border-pink-200">
                                <div class="flex items-center justify-between mb-3">
                                    <div>
                                        <p class="text-xs text-pink-500 font-medium">–ê–ö–¢–ò–í–ù–ê–Ø –ö–û–õ–õ–ê–ë–û–†–ê–¶–ò–Ø</p>
                                        <p class="font-semibold">–û–∂–∏–¥–∞–µ—Ç –≤–∞—à –∫–æ–Ω—Ç–µ–Ω—Ç</p>
                                    </div>
                                    <span class="text-2xl">üì∏</span>
                                </div>
                                
                                <div class="flex items-center gap-2 mb-4">
                                    ${activeCollab.products.map(id => {
                                        const p = PRODUCTS.find(x => x.id === id);
                                        return `<span class="text-xl">${p?.image || 'üì¶'}</span>`;
                                    }).join('')}
                                    <span class="text-sm text-gray-500">${activeCollab.products.length} –ø—Ä–æ–¥—É–∫—Ç–∞</span>
                                </div>
                                
                                ${renderTimer(activeCollab.deadline)}
                                
                                <button onclick="openCollabDetail(${activeCollab.id})" class="w-full gradient-pink text-white py-3 rounded-xl font-medium mt-4">
                                    –ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç
                                </button>
                            </div>
                        ` : `
                            <div class="card p-5 mb-4 text-center">
                                <span class="text-4xl mb-3 block">üéÅ</span>
                                <p class="font-semibold mb-1">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–æ–ª–ª–∞–±–æ—Ä–∞—Ü–∏–π</p>
                                <p class="text-sm text-gray-500 mb-4">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–¥—É–∫—Ç—ã –¥–ª—è –Ω–æ–≤–æ–≥–æ –æ–±–∑–æ—Ä–∞</p>
                                <button onclick="goToTab('catalog')" class="gradient-pink text-white px-6 py-3 rounded-xl font-medium">
                                    –ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–∞—Ç–∞–ª–æ–≥
                                </button>
                            </div>
                        `}
                        
                        <!-- Quick Actions -->
                        <div class="grid grid-cols-2 gap-3 mb-4">
                            <div onclick="goToTab('catalog')" class="card p-4 card-hover cursor-pointer">
                                <span class="text-2xl mb-2 block">üõçÔ∏è</span>
                                <p class="font-semibold text-sm">–ö–∞—Ç–∞–ª–æ–≥</p>
                                <p class="text-xs text-gray-500">${PRODUCTS.length} –ø—Ä–æ–¥—É–∫—Ç–æ–≤</p>
                            </div>
                            <div onclick="goToTab('rating')" class="card p-4 card-hover cursor-pointer">
                                <span class="text-2xl mb-2 block">üèÜ</span>
                                <p class="font-semibold text-sm">–†–µ–π—Ç–∏–Ω–≥</p>
                                <p class="text-xs text-gray-500">#${LEADERBOARD.find(l => l.isCurrentUser)?.rank || '-'} –≤ —Ç–æ–ø–µ</p>
                            </div>
                        </div>
                        
                        <!-- Achievements Preview -->
                        <div class="card p-4">
                            <div class="flex items-center justify-between mb-3">
                                <p class="font-semibold">–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</p>
                                <button onclick="openAchievements()" class="text-pink-500 text-sm">–í—Å–µ ‚Üí</button>
                            </div>
                            <div class="flex gap-3 overflow-x-auto hide-scrollbar">
                                ${ACHIEVEMENTS.slice(0, 5).map(a => `
                                    <div class="flex-shrink-0 w-16 text-center ${!isAchievementUnlocked(a) ? 'achievement-locked' : ''}">
                                        <div class="w-12 h-12 mx-auto bg-gray-100 rounded-xl flex items-center justify-center text-2xl mb-1">
                                            ${a.icon}
                                        </div>
                                        <p class="text-[10px] text-gray-600 truncate">${a.name}</p>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function renderTimer(deadline) {
            const time = getTimeRemaining(deadline);
            
            if (time.expired) {
                return `
                    <div class="bg-red-50 text-red-600 p-3 rounded-xl text-center">
                        <p class="font-semibold">‚ö†Ô∏è –î–µ–¥–ª–∞–π–Ω –ø—Ä–æ—Å—Ä–æ—á–µ–Ω!</p>
                    </div>
                `;
            }
            
            return `
                <div class="flex justify-center gap-2">
                    <div class="timer-box">
                        <p class="text-xl font-bold">${time.days}</p>
                        <p class="text-[10px] text-gray-400">–¥–Ω–µ–π</p>
                    </div>
                    <div class="timer-box">
                        <p class="text-xl font-bold">${time.hours}</p>
                        <p class="text-[10px] text-gray-400">—á–∞—Å–æ–≤</p>
                    </div>
                    <div class="timer-box">
                        <p class="text-xl font-bold">${time.mins}</p>
                        <p class="text-[10px] text-gray-400">–º–∏–Ω—É—Ç</p>
                    </div>
                </div>
            `;
        }

        // ==================== CATALOG ====================
        
        function renderCatalog() {
            const categories = ['–í—Å–µ', '–õ–∏—Ü–æ', '–í–æ–ª–æ—Å—ã', '–¢–µ–ª–æ', '–ú–∞–∫–∏—è–∂'];
            const level = getLevel();
            const filtered = state.selectedCategory === '–í—Å–µ' 
                ? PRODUCTS 
                : PRODUCTS.filter(p => p.category === state.selectedCategory);
            
            return `
                <div class="pb-4">
                    <!-- Header -->
                    <div class="bg-white p-4 sticky top-0 z-50 border-b border-gray-100">
                        <h1 class="text-xl font-bold mb-1">–ö–∞—Ç–∞–ª–æ–≥ –ø—Ä–æ–¥—É–∫—Ç–æ–≤</h1>
                        <p class="text-sm text-gray-500">–í—ã–±–µ—Ä–∏—Ç–µ ${level.products[0]}-${level.products[1]} –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –¥–ª—è –∫–æ–ª–ª–∞–±–æ—Ä–∞—Ü–∏–∏</p>
                    </div>
                    
                    <!-- Categories -->
                    <div class="p-4 pb-2">
                        <div class="flex gap-2 overflow-x-auto hide-scrollbar -mx-4 px-4">
                            ${categories.map(cat => `
                                <button onclick="setCategory('${cat}')" 
                                    class="px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-all
                                    ${state.selectedCategory === cat 
                                        ? 'gradient-pink text-white shadow-md' 
                                        : 'bg-white text-gray-600 border border-gray-200'}">
                                    ${cat}
                                </button>
                            `).join('')}
                        </div>
                    </div>
                    
                    <!-- Products Grid -->
                    <div class="px-4 grid grid-cols-2 gap-3">
                        ${filtered.map(p => renderProductCard(p)).join('')}
                    </div>
                </div>
            `;
        }
        
        function renderProductCard(product) {
            const isSelected = state.selectedProducts.includes(product.id);
            const level = getLevel();
            const canSelect = state.selectedProducts.length < level.products[1] || isSelected;
            const isLocked = product.minLevel > state.user.levelIndex;
            
            return `
                <div onclick="${isLocked ? '' : `toggleProduct(${product.id})`}" 
                    class="card overflow-hidden card-hover ${isSelected ? 'product-selected' : ''} ${isLocked ? 'opacity-50' : 'cursor-pointer'}">
                    
                    ${product.badge ? `
                        <div class="absolute top-2 left-2 z-10">
                            <span class="badge badge-${product.badge.toLowerCase()}">${product.badge}</span>
                        </div>
                    ` : ''}
                    
                    ${isLocked ? `
                        <div class="absolute top-2 right-2 z-10">
                            <span class="bg-gray-800 text-white text-[10px] px-2 py-1 rounded-full">üîí ${LEVELS[product.minLevel].name}</span>
                        </div>
                    ` : ''}
                    
                    <div class="h-32 flex items-center justify-center text-5xl relative" style="background: ${product.color}30">
                        ${product.image}
                        ${isSelected ? `
                            <div class="absolute inset-0 bg-pink-500/30 flex items-center justify-center">
                                <div class="w-10 h-10 bg-pink-500 rounded-full flex items-center justify-center text-white text-xl bounce-in">‚úì</div>
                            </div>
                        ` : ''}
                    </div>
                    
                    <div class="p-3">
                        <h3 class="font-semibold text-sm mb-1 line-clamp-1">${product.name}</h3>
                        <p class="text-xs text-gray-500 mb-2">${product.volume} ‚Ä¢ ${product.category}</p>
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-1">
                                <span class="text-amber-400">‚òÖ</span>
                                <span class="text-sm font-medium">${product.rating}</span>
                                <span class="text-xs text-gray-400">(${product.reviews})</span>
                            </div>
                            <button onclick="event.stopPropagation(); openProductDetail(${product.id})" class="text-pink-500 text-xs">
                                –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function renderFloatingCart() {
            const level = getLevel();
            const canOrder = state.selectedProducts.length >= level.products[0];
            
            return `
                <div class="floating-cart slide-up">
                    <div class="card p-4 shadow-lg border border-pink-200">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="font-semibold">–í—ã–±—Ä–∞–Ω–æ: ${state.selectedProducts.length}/${level.products[1]}</p>
                                <p class="text-xs text-gray-500">${canOrder ? '–ú–æ–∂–Ω–æ –æ—Ñ–æ—Ä–º–∏—Ç—å' : `–ú–∏–Ω–∏–º—É–º ${level.products[0]} –ø—Ä–æ–¥—É–∫—Ç–∞`}</p>
                            </div>
                            <button onclick="${canOrder ? 'openCart()' : ''}" 
                                class="px-6 py-3 rounded-xl font-semibold ${canOrder ? 'gradient-pink text-white' : 'bg-gray-200 text-gray-400'}">
                                –û—Ñ–æ—Ä–º–∏—Ç—å
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function renderProductDetail() {
            const product = PRODUCTS.find(p => p.id === state.currentProduct);
            if (!product) return '';
            
            const isSelected = state.selectedProducts.includes(product.id);
            const isLocked = product.minLevel > state.user.levelIndex;
            
            return `
                <div class="pb-24">
                    <div class="sticky top-0 bg-white z-50 p-4 flex items-center gap-4 border-b border-gray-100">
                        <button onclick="closeProductDetail()" class="w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center">
                            ‚Üê
                        </button>
                        <h1 class="font-semibold flex-1">–û –ø—Ä–æ–¥—É–∫—Ç–µ</h1>
                    </div>
                    
                    <div class="h-64 flex items-center justify-center text-8xl" style="background: ${product.color}30">
                        ${product.image}
                    </div>
                    
                    <div class="p-4">
                        <div class="flex items-start justify-between mb-2">
                            <div>
                                ${product.badge ? `<span class="badge badge-${product.badge.toLowerCase()} mb-2 inline-block">${product.badge}</span>` : ''}
                                <h1 class="text-xl font-bold">${product.name}</h1>
                            </div>
                        </div>
                        
                        <div class="flex items-center gap-4 mb-4">
                            <span class="text-gray-500">${product.volume}</span>
                            <span class="text-gray-500">‚Ä¢</span>
                            <span class="text-gray-500">${product.category}</span>
                        </div>
                        
                        <div class="flex items-center gap-2 mb-6">
                            <div class="flex text-amber-400">
                                ${'‚òÖ'.repeat(Math.floor(product.rating))}${product.rating % 1 ? '¬Ω' : ''}
                            </div>
                            <span class="font-semibold">${product.rating}</span>
                            <span class="text-gray-400">(${product.reviews} –æ—Ç–∑—ã–≤–æ–≤)</span>
                        </div>
                        
                        <div class="card p-4 mb-4">
                            <h3 class="font-semibold mb-2">–û–ø–∏—Å–∞–Ω–∏–µ</h3>
                            <p class="text-gray-600 text-sm leading-relaxed">${product.desc}</p>
                        </div>
                        
                        ${isLocked ? `
                            <div class="card p-4 bg-gray-50 border border-gray-200">
                                <div class="flex items-center gap-3">
                                    <span class="text-3xl">üîí</span>
                                    <div>
                                        <p class="font-semibold">–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ –¥–ª—è –≤–∞—à–µ–≥–æ —É—Ä–æ–≤–Ω—è</p>
                                        <p class="text-sm text-gray-500">–¢—Ä–µ–±—É–µ—Ç—Å—è —É—Ä–æ–≤–µ–Ω—å: ${LEVELS[product.minLevel].name}</p>
                                    </div>
                                </div>
                            </div>
                        ` : `
                            <button onclick="toggleProduct(${product.id}); closeProductDetail();" 
                                class="w-full py-4 rounded-xl font-semibold ${isSelected ? 'bg-gray-200 text-gray-700' : 'gradient-pink text-white'}">
                                ${isSelected ? '‚úì –£–±—Ä–∞—Ç—å –∏–∑ –±–æ–∫—Å–∞' : '+ –î–æ–±–∞–≤–∏—Ç—å –≤ –±–æ–∫—Å'}
                            </button>
                        `}
                    </div>
                </div>
            `;
        }

        // ==================== COLLABORATIONS ====================
        
        function renderCollabs() {
            const active = state.collaborations.filter(c => !['completed'].includes(c.status));
            const completed = state.collaborations.filter(c => c.status === 'completed');
            
            return `
                <div class="pb-4">
                    <div class="bg-white p-4 sticky top-0 z-50 border-b border-gray-100">
                        <h1 class="text-xl font-bold">–ú–æ–∏ –∫–æ–ª–ª–∞–±–æ—Ä–∞—Ü–∏–∏</h1>
                    </div>
                    
                    <div class="p-4">
                        ${active.length > 0 ? `
                            <h2 class="font-semibold text-gray-500 text-sm mb-3">–ê–ö–¢–ò–í–ù–´–ï</h2>
                            <div class="space-y-3 mb-6">
                                ${active.map(c => renderCollabCard(c)).join('')}
                            </div>
                        ` : ''}
                        
                        ${completed.length > 0 ? `
                            <h2 class="font-semibold text-gray-500 text-sm mb-3">–ó–ê–í–ï–†–®–Å–ù–ù–´–ï</h2>
                            <div class="space-y-3">
                                ${completed.map(c => renderCollabCard(c)).join('')}
                            </div>
                        ` : ''}
                        
                        ${state.collaborations.length === 0 ? `
                            <div class="text-center py-12">
                                <span class="text-5xl mb-4 block">üì¶</span>
                                <p class="font-semibold mb-1">–ü–æ–∫–∞ –Ω–µ—Ç –∫–æ–ª–ª–∞–±–æ—Ä–∞—Ü–∏–π</p>
                                <p class="text-sm text-gray-500 mb-4">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–¥—É–∫—Ç—ã –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –æ–±–∑–æ—Ä–∞</p>
                                <button onclick="goToTab('catalog')" class="gradient-pink text-white px-6 py-3 rounded-xl font-medium">
                                    –ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–∞—Ç–∞–ª–æ–≥
                                </button>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
        }
        
        function renderCollabCard(collab) {
            const products = collab.products.map(id => PRODUCTS.find(p => p.id === id)).filter(Boolean);
            
            return `
                <div onclick="openCollabDetail(${collab.id})" class="card p-4 card-hover cursor-pointer">
                    <div class="flex items-center justify-between mb-3">
                        <span class="text-sm font-medium ${getStatusColor(collab.status)}">${getStatusText(collab.status)}</span>
                        ${collab.rating ? `
                            <div class="flex items-center gap-1">
                                <span class="text-amber-400">${'‚òÖ'.repeat(collab.rating)}</span>
                            </div>
                        ` : ''}
                    </div>
                    
                    <div class="flex items-center gap-2 mb-3">
                        ${products.slice(0, 3).map(p => `
                            <div class="w-10 h-10 rounded-lg flex items-center justify-center text-xl" style="background: ${p.color}30">
                                ${p.image}
                            </div>
                        `).join('')}
                        ${products.length > 3 ? `<span class="text-sm text-gray-500">+${products.length - 3}</span>` : ''}
                        <div class="flex-1 ml-2">
                            <p class="font-medium text-sm">${products.map(p => p.name).join(', ')}</p>
                        </div>
                    </div>
                    
                    <div class="flex items-center justify-between text-xs text-gray-500">
                        <span>–°–æ–∑–¥–∞–Ω: ${collab.createdAt}</span>
                        ${collab.pointsEarned ? `<span class="text-green-500 font-medium">+${collab.pointsEarned} –æ—á–∫–æ–≤</span>` : ''}
                    </div>
                </div>
            `;
        }
        
        function renderCollabDetail() {
            const collab = state.collaborations.find(c => c.id === state.modalData);
            if (!collab) return '';
            
            const products = collab.products.map(id => PRODUCTS.find(p => p.id === id)).filter(Boolean);
            const time = getTimeRemaining(collab.deadline);
            
            return `
                <div class="pb-24">
                    <div class="sticky top-0 bg-white z-50 p-4 flex items-center gap-4 border-b border-gray-100">
                        <button onclick="closeCollabDetail()" class="w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center">
                            ‚Üê
                        </button>
                        <h1 class="font-semibold flex-1">–ö–æ–ª–ª–∞–±–æ—Ä–∞—Ü–∏—è #${collab.id}</h1>
                    </div>
                    
                    <div class="p-4">
                        <!-- Status -->
                        <div class="card p-4 mb-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-500">–°—Ç–∞—Ç—É—Å</p>
                                    <p class="font-semibold ${getStatusColor(collab.status)}">${getStatusText(collab.status)}</p>
                                </div>
                                ${collab.rating ? `
                                    <div class="text-right">
                                        <p class="text-sm text-gray-500">–û—Ü–µ–Ω–∫–∞</p>
                                        <p class="text-amber-400 text-lg">${'‚òÖ'.repeat(collab.rating)}</p>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                        
                        <!-- Timer -->
                        ${collab.status === 'awaiting' ? `
                            <div class="card p-4 mb-4">
                                <p class="text-sm text-gray-500 text-center mb-3">–û—Å—Ç–∞–ª–æ—Å—å –≤—Ä–µ–º–µ–Ω–∏</p>
                                ${renderTimer(collab.deadline)}
                            </div>
                        ` : ''}
                        
                        <!-- Products -->
                        <div class="card p-4 mb-4">
                            <h3 class="font-semibold mb-3">–ü—Ä–æ–¥—É–∫—Ç—ã</h3>
                            <div class="space-y-3">
                                ${products.map(p => `
                                    <div class="flex items-center gap-3">
                                        <div class="w-14 h-14 rounded-xl flex items-center justify-center text-2xl" style="background: ${p.color}30">
                                            ${p.image}
                                        </div>
                                        <div>
                                            <p class="font-medium">${p.name}</p>
                                            <p class="text-sm text-gray-500">${p.volume}</p>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <!-- Timeline -->
                        <div class="card p-4 mb-4">
                            <h3 class="font-semibold mb-3">–ò—Å—Ç–æ—Ä–∏—è</h3>
                            <div class="space-y-3">
                                <div class="flex items-center gap-3">
                                    <div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center text-green-500">‚úì</div>
                                    <div>
                                        <p class="font-medium text-sm">–ó–∞—è–≤–∫–∞ —Å–æ–∑–¥–∞–Ω–∞</p>
                                        <p class="text-xs text-gray-500">${collab.createdAt}</p>
                                    </div>
                                </div>
                                ${collab.deliveredAt ? `
                                    <div class="flex items-center gap-3">
                                        <div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center text-green-500">‚úì</div>
                                        <div>
                                            <p class="font-medium text-sm">–î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ</p>
                                            <p class="text-xs text-gray-500">${collab.deliveredAt}</p>
                                        </div>
                                    </div>
                                ` : ''}
                                ${collab.submittedAt ? `
                                    <div class="flex items-center gap-3">
                                        <div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center text-green-500">‚úì</div>
                                        <div>
                                            <p class="font-medium text-sm">–ö–æ–Ω—Ç–µ–Ω—Ç –∑–∞–≥—Ä—É–∂–µ–Ω</p>
                                            <p class="text-xs text-gray-500">${collab.submittedAt}</p>
                                        </div>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                        
                        <!-- Action -->
                        ${collab.status === 'awaiting' ? `
                            <button onclick="openContentModal(${collab.id})" class="w-full gradient-pink text-white py-4 rounded-xl font-semibold">
                                üì∏ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ –∫–æ–Ω—Ç–µ–Ω—Ç
                            </button>
                        ` : ''}
                        
                        ${collab.pointsEarned ? `
                            <div class="card p-4 bg-green-50 border border-green-200 text-center">
                                <p class="text-green-600 font-semibold">üéâ –í—ã –∑–∞—Ä–∞–±–æ—Ç–∞–ª–∏ +${collab.pointsEarned} –æ—á–∫–æ–≤!</p>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        // ==================== RATING ====================
        
        function renderRating() {
            const level = getLevel();
            const myRank = LEADERBOARD.find(l => l.isCurrentUser)?.rank || '-';
            
            return `
                <div class="pb-4">
                    <div class="gradient-pink p-5 pb-8 rounded-b-[32px]">
                        <h1 class="text-white text-xl font-bold mb-4">–†–µ–π—Ç–∏–Ω–≥ –±–ª–æ–≥–µ—Ä–æ–≤</h1>
                        <div class="flex items-center gap-4">
                            <div class="flex-1">
                                <p class="text-white/70 text-sm">–í–∞—à–∞ –ø–æ–∑–∏—Ü–∏—è</p>
                                <p class="text-white text-4xl font-bold">#${myRank}</p>
                            </div>
                            <div class="text-right">
                                <p class="text-white/70 text-sm">–£—Ä–æ–≤–µ–Ω—å</p>
                                <p class="text-white font-semibold">${level.emoji} ${level.name}</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="px-4 -mt-4">
                        <div class="card overflow-hidden">
                            ${LEADERBOARD.map((blogger, i) => `
                                <div class="flex items-center gap-3 p-4 ${i < LEADERBOARD.length - 1 ? 'border-b border-gray-50' : ''} ${blogger.isCurrentUser ? 'bg-pink-50' : ''}">
                                    <div class="w-8 text-center font-bold ${i < 3 ? 'text-lg' : 'text-gray-400'}">
                                        ${i === 0 ? 'ü•á' : i === 1 ? 'ü•à' : i === 2 ? 'ü•â' : blogger.rank}
                                    </div>
                                    <div class="w-10 h-10 bg-gradient-to-br from-pink-100 to-rose-100 rounded-full flex items-center justify-center text-xl">
                                        ${blogger.avatar}
                                    </div>
                                    <div class="flex-1 min-w-0">
                                        <p class="font-medium text-sm truncate">${blogger.name}</p>
                                        <p class="text-xs text-gray-500">${blogger.username}</p>
                                    </div>
                                    <div class="text-right">
                                        <p class="font-bold text-pink-500">${blogger.points.toLocaleString()}</p>
                                        <p class="text-[10px] text-gray-400">–æ—á–∫–æ–≤</p>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        
                        <div class="card p-4 mt-4 bg-amber-50 border border-amber-200">
                            <div class="flex items-center gap-3">
                                <span class="text-2xl">üèÜ</span>
                                <div>
                                    <p class="font-semibold text-sm">–ù–∞–≥—Ä–∞–¥—ã –ª–∏–¥–µ—Ä–∞–º</p>
                                    <p class="text-xs text-amber-700">1 –º–µ—Å—Ç–æ ‚Äî —É–¥–≤–æ–µ–Ω–Ω—ã–π –ª–∏–º–∏—Ç –ø—Ä–æ–¥—É–∫—Ç–æ–≤</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // ==================== PROFILE ====================
        
        function renderProfile() {
            const level = getLevel();
            
            return `
                <div class="pb-4">
                    <div class="bg-white p-4 sticky top-0 z-50 border-b border-gray-100">
                        <h1 class="text-xl font-bold">–ü—Ä–æ—Ñ–∏–ª—å</h1>
                    </div>
                    
                    <div class="p-4">
                        <!-- User Card -->
                        <div class="card p-5 mb-4">
                            <div class="flex items-center gap-4 mb-4">
                                <div class="w-16 h-16 gradient-pink rounded-full flex items-center justify-center text-3xl text-white">
                                    üíÅ‚Äç‚ôÄÔ∏è
                                </div>
                                <div class="flex-1">
                                    <h2 class="font-bold text-lg">${state.user.name}</h2>
                                    <p class="text-gray-500">${state.user.instagram}</p>
                                    <span class="level-badge level-${state.user.levelIndex} mt-2 inline-block">${level.emoji} ${level.name}</span>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-3 gap-4 p-4 bg-gray-50 rounded-xl">
                                <div class="text-center">
                                    <p class="text-xl font-bold">${formatNumber(state.user.followers)}</p>
                                    <p class="text-xs text-gray-500">–ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤</p>
                                </div>
                                <div class="text-center">
                                    <p class="text-xl font-bold text-green-500">${state.user.er}%</p>
                                    <p class="text-xs text-gray-500">ER</p>
                                </div>
                                <div class="text-center">
                                    <p class="text-xl font-bold text-pink-500">${state.user.points}</p>
                                    <p class="text-xs text-gray-500">–æ—á–∫–æ–≤</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Connected Accounts -->
                        <div class="card p-4 mb-4">
                            <h3 class="font-semibold mb-3">–ü—Ä–∏–≤—è–∑–∞–Ω–Ω—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã</h3>
                            <div class="space-y-3">
                                <div class="flex items-center gap-3 p-3 bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl">
                                    <span class="text-2xl">üì∑</span>
                                    <div class="flex-1">
                                        <p class="font-medium">Instagram</p>
                                        <p class="text-sm text-gray-500">${state.user.instagram}</p>
                                    </div>
                                    <span class="text-green-500">‚úì</span>
                                </div>
                                ${state.user.tiktok ? `
                                    <div class="flex items-center gap-3 p-3 bg-gradient-to-r from-gray-50 to-gray-100 rounded-xl">
                                        <span class="text-2xl">üéµ</span>
                                        <div class="flex-1">
                                            <p class="font-medium">TikTok</p>
                                            <p class="text-sm text-gray-500">${state.user.tiktok}</p>
                                        </div>
                                        <span class="text-green-500">‚úì</span>
                                    </div>
                                ` : `
                                    <button class="flex items-center gap-3 p-3 border border-dashed border-gray-200 rounded-xl w-full">
                                        <span class="text-2xl">üéµ</span>
                                        <span class="text-gray-500">–ü–æ–¥–∫–ª—é—á–∏—Ç—å TikTok</span>
                                    </button>
                                `}
                            </div>
                        </div>
                        
                        <!-- Level Privileges -->
                        <div class="card p-4 mb-4">
                            <h3 class="font-semibold mb-3">–í–∞—à–∏ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏</h3>
                            <div class="space-y-2 text-sm">
                                <div class="flex items-center gap-2">
                                    <span class="text-pink-500">‚úì</span>
                                    <span>${level.products[0]}-${level.products[1]} –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –∑–∞ –∫–æ–ª–ª–∞–±–æ—Ä–∞—Ü–∏—é</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span class="text-pink-500">‚úì</span>
                                    <span>${level.days} –¥–Ω–µ–π –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span class="text-pink-500">‚úì</span>
                                    <span>${level.collabs === 999 ? '–ë–µ–∑–ª–∏–º–∏—Ç–Ω—ã–µ' : level.collabs} –∫–æ–ª–ª–∞–±–æ—Ä–∞—Ü–∏–∏ –≤ –º–µ—Å—è—Ü</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Referral -->
                        <div class="card p-4 gradient-gold text-gray-900">
                            <div class="flex items-center gap-3 mb-3">
                                <span class="text-2xl">ü§ù</span>
                                <div>
                                    <p class="font-bold">–ü—Ä–∏–≥–ª–∞—Å–∏—Ç–µ –¥—Ä—É–≥–∞</p>
                                    <p class="text-sm opacity-80">–ü–æ–ª—É—á–∏—Ç–µ +200 –æ—á–∫–æ–≤</p>
                                </div>
                            </div>
                            <div class="bg-white/50 rounded-xl p-3 flex items-center justify-between">
                                <code class="font-mono font-bold">${state.user.referralCode}</code>
                                <button onclick="copyReferral()" class="text-sm font-medium">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // ==================== MODALS ====================
        
        function renderModal() {
            if (state.showModal === 'cart') return renderCartModal();
            if (state.showModal === 'delivery') return renderDeliveryModal();
            if (state.showModal === 'success') return renderSuccessModal();
            if (state.showModal === 'content') return renderContentModal();
            if (state.showModal === 'achievements') return renderAchievementsModal();
            return '';
        }
        
        function renderCartModal() {
            const products = PRODUCTS.filter(p => state.selectedProducts.includes(p.id));
            
            return `
                <div class="modal-overlay fade-in" onclick="closeModal()">
                    <div class="modal-content slide-up" onclick="event.stopPropagation()">
                        <div class="p-4 border-b border-gray-100 flex items-center justify-between">
                            <h2 class="font-bold text-lg">–í–∞—à –±–æ–∫—Å</h2>
                            <button onclick="closeModal()" class="text-gray-400">‚úï</button>
                        </div>
                        
                        <div class="p-4 max-h-[50vh] overflow-y-auto">
                            ${products.map(p => `
                                <div class="flex items-center gap-3 py-3 border-b border-gray-50">
                                    <div class="w-14 h-14 rounded-xl flex items-center justify-center text-2xl" style="background: ${p.color}30">
                                        ${p.image}
                                    </div>
                                    <div class="flex-1">
                                        <p class="font-medium">${p.name}</p>
                                        <p class="text-sm text-gray-500">${p.volume}</p>
                                    </div>
                                    <button onclick="toggleProduct(${p.id})" class="text-gray-400 p-2">‚úï</button>
                                </div>
                            `).join('')}
                        </div>
                        
                        <div class="p-4">
                            <button onclick="openDelivery()" class="w-full gradient-pink text-white py-4 rounded-xl font-semibold">
                                –î–∞–ª–µ–µ ‚Äî –î–æ—Å—Ç–∞–≤–∫–∞
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function renderDeliveryModal() {
            return `
                <div class="modal-overlay fade-in" onclick="closeModal()">
                    <div class="modal-content slide-up" onclick="event.stopPropagation()">
                        <div class="p-4 border-b border-gray-100 flex items-center justify-between">
                            <h2 class="font-bold text-lg">–î–∞–Ω–Ω—ã–µ –¥–æ—Å—Ç–∞–≤–∫–∏</h2>
                            <button onclick="closeModal()" class="text-gray-400">‚úï</button>
                        </div>
                        
                        <div class="p-4 space-y-4">
                            <input type="text" id="d_name" placeholder="–§–ò–û –ø–æ–ª—É—á–∞—Ç–µ–ª—è" value="${state.delivery.name}"
                                class="w-full px-4 py-3.5 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-pink-500">
                            <input type="tel" id="d_phone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω" value="${state.delivery.phone}"
                                class="w-full px-4 py-3.5 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-pink-500">
                            <textarea id="d_address" placeholder="–ê–¥—Ä–µ—Å —Å –∏–Ω–¥–µ–∫—Å–æ–º" rows="3"
                                class="w-full px-4 py-3.5 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-pink-500 resize-none">${state.delivery.address}</textarea>
                            <input type="text" id="d_comment" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫—É—Ä—å–µ—Ä—É" value="${state.delivery.comment}"
                                class="w-full px-4 py-3.5 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-pink-500">
                        </div>
                        
                        <div class="p-4">
                            <div class="bg-amber-50 border border-amber-200 rounded-xl p-3 mb-4 text-sm">
                                <p class="text-amber-800">‚è∞ –°—Ä–æ–∫ –Ω–∞ –∫–æ–Ω—Ç–µ–Ω—Ç: <strong>${getLevel().days} –¥–Ω–µ–π</strong></p>
                            </div>
                            <button onclick="submitOrder()" class="w-full gradient-pink text-white py-4 rounded-xl font-semibold">
                                –û—Ñ–æ—Ä–º–∏—Ç—å –∫–æ–ª–ª–∞–±–æ—Ä–∞—Ü–∏—é
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function renderSuccessModal() {
            return `
                <div class="modal-overlay fade-in">
                    <div class="modal-content slide-up p-8 text-center">
                        <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center text-4xl mx-auto mb-4 bounce-in">
                            ‚úì
                        </div>
                        <h2 class="text-xl font-bold mb-2">–ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!</h2>
                        <p class="text-gray-500 mb-6">–ú—ã –æ—Ç–ø—Ä–∞–≤–∏–º –±–æ–∫—Å –ø–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è</p>
                        <button onclick="closeSuccess()" class="gradient-pink text-white px-8 py-4 rounded-xl font-semibold">
                            –û—Ç–ª–∏—á–Ω–æ!
                        </button>
                    </div>
                </div>
            `;
        }
        
        function renderContentModal() {
            return `
                <div class="modal-overlay fade-in" onclick="closeModal()">
                    <div class="modal-content slide-up" onclick="event.stopPropagation()">
                        <div class="p-4 border-b border-gray-100 flex items-center justify-between">
                            <h2 class="font-bold text-lg">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç</h2>
                            <button onclick="closeModal()" class="text-gray-400">‚úï</button>
                        </div>
                        
                        <div class="p-4">
                            <p class="text-sm text-gray-500 mb-4">–í—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã–π –ø–æ—Å—Ç –∏–ª–∏ Reels</p>
                            <input type="url" id="content_link" placeholder="https://instagram.com/p/..."
                                class="w-full px-4 py-3.5 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-pink-500 mb-4">
                            <button onclick="submitContent()" class="w-full gradient-pink text-white py-4 rounded-xl font-semibold">
                                –û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function renderAchievementsModal() {
            return `
                <div class="modal-overlay fade-in" onclick="closeModal()">
                    <div class="modal-content slide-up" onclick="event.stopPropagation()" style="max-height: 85vh">
                        <div class="p-4 border-b border-gray-100 flex items-center justify-between sticky top-0 bg-white">
                            <h2 class="font-bold text-lg">–í—Å–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h2>
                            <button onclick="closeModal()" class="text-gray-400">‚úï</button>
                        </div>
                        
                        <div class="p-4 grid grid-cols-3 gap-3">
                            ${ACHIEVEMENTS.map(a => {
                                const unlocked = isAchievementUnlocked(a);
                                return `
                                    <div class="text-center p-3 rounded-xl ${unlocked ? 'bg-amber-50 border border-amber-200' : 'bg-gray-50 achievement-locked'}">
                                        <div class="text-3xl mb-2">${a.icon}</div>
                                        <p class="font-medium text-xs mb-1">${a.name}</p>
                                        <p class="text-[10px] text-gray-500">+${a.points}</p>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        // ==================== TAB BAR ====================
        
        function renderTabBar() {
            const tabs = [
                { id: 'home', icon: 'üè†', label: '–ì–ª–∞–≤–Ω–∞—è' },
                { id: 'catalog', icon: 'üõçÔ∏è', label: '–ö–∞—Ç–∞–ª–æ–≥' },
                { id: 'collabs', icon: 'üì¶', label: '–ö–æ–ª–ª–∞–±—ã' },
                { id: 'rating', icon: 'üèÜ', label: '–†–µ–π—Ç–∏–Ω–≥' },
                { id: 'profile', icon: 'üë§', label: '–ü—Ä–æ—Ñ–∏–ª—å' },
            ];
            
            return `
                <div class="tab-bar">
                    <div class="flex justify-around">
                        ${tabs.map(tab => `
                            <button onclick="goToTab('${tab.id}')" class="tab-item ${state.currentTab === tab.id ? 'active' : ''}">
                                <span class="icon">${tab.icon}</span>
                                <span class="label">${tab.label}</span>
                            </button>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        // ==================== ACTIONS ====================
        
        function goToTab(tab) {
            state.currentTab = tab;
            state.currentPage = 'main';
            haptic();
            render();
            window.scrollTo(0, 0);
        }
        
        function setCategory(cat) {
            state.selectedCategory = cat;
            haptic();
            render();
        }
        
        function toggleProduct(id) {
            const level = getLevel();
            const product = PRODUCTS.find(p => p.id === id);
            
            if (product.minLevel > state.user.levelIndex) return;
            
            if (state.selectedProducts.includes(id)) {
                state.selectedProducts = state.selectedProducts.filter(x => x !== id);
            } else if (state.selectedProducts.length < level.products[1]) {
                state.selectedProducts.push(id);
                haptic('medium');
            } else {
                haptic('error');
            }
            render();
        }
        
        function openProductDetail(id) {
            state.currentProduct = id;
            state.currentPage = 'product';
            haptic();
            render();
        }
        
        function closeProductDetail() {
            state.currentPage = 'main';
            render();
        }
        
        function openCart() {
            state.showModal = 'cart';
            haptic();
            render();
        }
        
        function openDelivery() {
            state.showModal = 'delivery';
            render();
        }
        
        function closeModal() {
            state.showModal = null;
            render();
        }
        
        function submitOrder() {
            const name = document.getElementById('d_name').value;
            const phone = document.getElementById('d_phone').value;
            const address = document.getElementById('d_address').value;
            
            if (!name || !phone || !address) {
                tg?.showAlert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è');
                return;
            }
            
            state.delivery = { name, phone, address, comment: document.getElementById('d_comment').value };
            
            // Create new collab
            const newCollab = {
                id: Date.now(),
                status: 'pending',
                products: [...state.selectedProducts],
                createdAt: new Date().toISOString().split('T')[0],
                deadline: new Date(Date.now() + getLevel().days * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
            };
            
            state.collaborations.unshift(newCollab);
            state.selectedProducts = [];
            
            if (tg) {
                tg.sendData(JSON.stringify({ action: 'new_order', collab: newCollab, delivery: state.delivery, user: state.user }));
            }
            
            state.showModal = 'success';
            haptic('success');
            render();
        }
        
        function closeSuccess() {
            state.showModal = null;
            state.currentTab = 'collabs';
            render();
        }
        
        function openCollabDetail(id) {
            state.modalData = id;
            state.currentPage = 'collab-detail';
            haptic();
            render();
        }
        
        function closeCollabDetail() {
            state.currentPage = 'main';
            render();
        }
        
        function openContentModal(id) {
            state.modalData = id;
            state.showModal = 'content';
            render();
        }
        
        function submitContent() {
            const link = document.getElementById('content_link').value;
            if (!link) {
                tg?.showAlert('–í—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ –∫–æ–Ω—Ç–µ–Ω—Ç');
                return;
            }
            
            const collab = state.collaborations.find(c => c.id === state.modalData);
            if (collab) {
                collab.contentLink = link;
                collab.status = 'completed';
                collab.submittedAt = new Date().toISOString().split('T')[0];
                collab.rating = 5;
                collab.pointsEarned = 300;
                state.user.points += 300;
                state.user.totalCollabs++;
            }
            
            if (tg) {
                tg.sendData(JSON.stringify({ action: 'content_submitted', collabId: state.modalData, link }));
            }
            
            state.showModal = null;
            haptic('success');
            tg?.showAlert('–ö–æ–Ω—Ç–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω! +300 –æ—á–∫–æ–≤ üéâ');
            render();
        }
        
        function openAchievements() {
            state.showModal = 'achievements';
            haptic();
            render();
        }
        
        function copyReferral() {
            navigator.clipboard?.writeText(state.user.referralCode);
            tg?.showAlert('–ö–æ–¥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!');
            haptic();
        }

        // ==================== INIT ====================
        
        render();
    </script>
</body>
</html>
